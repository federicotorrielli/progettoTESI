<html>
<head>
    <script src='https://code.jquery.com/jquery-3.4.1.min.js' type='text/javascript'></script>
    <link href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" rel="stylesheet"/>
    <link href="plugins/mui-0.10.1/css/mui.css" rel="stylesheet"/>
    <link href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css" rel="stylesheet"/>
    <script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
    <style media="screen">
        #map {
            width: 100%;
            height: 100%
        }
    </style>
    <title>Mappa di Torino</title>
</head>
<body>
<div id="map"></div>
<div class="leaflet-top leaflet-right" style="pointer-events: auto">
    <button block class="mui-btn mui-btn--primary leaflet-clickable" id="bottone1" onclick="buttonPressedMap();">Attiva
        Funzione
    </button>
</div>
<script type="text/javascript">
    let buttonPressed = false;

    let map = L.map('map', {
        center: [45.0709823, 7.6777233],
        minZoom: 2,
        zoom: 15
    });

    L.PM.initialize({optIn: true});

    L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
        subdomains: ['a', 'b', 'c']
    }).addTo(map);
    $.get("https://beta.ontomap.ontomap.eu/features?lat=45.0709823&lng=7.6777233&maxDistance=400&minDistance=300", function (geojsonFeature) {
        L.geoJSON(geojsonFeature, {
            onEachFeature(feature, layer) {
                layer.bindPopup(L.popup({maxHeight: 200}, layer).setContent(feature.properties.label));
            }
        }).addTo(map);
    });

    let clickCircle = undefined;

    function onMapClick(e) {
        if (buttonPressed) {
            if (clickCircle !== undefined) {
                map.removeLayer(clickCircle);
            }
            clickCircle = L.circle(e.latlng, 100 * 3, {
                color: '#f07300',
                fillOpacity: 0.1,
                opacity: 0.5,
            }).addTo(map);
        }
    }

    function buttonPressedMap() {
        buttonPressed = !buttonPressed;
        if (buttonPressed)
            document.getElementById("bottone1").innerText = "Disattiva Funzione";
        else
            document.getElementById("bottone1").innerText = "Attiva Funzione";
    }

    map.pm.addControls({
        position: 'topleft',
        drawCircle: false,
        // Qua disattivo tutto tranne drawCircle todo
    });

    map.on('click', onMapClick);
</script>
</body>
</html>
